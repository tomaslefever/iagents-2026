<html lang="es" class="dark"><head><meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Arquitectura MCP - Agentia Blog</title>
<!-- Fonts -->
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="">
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600&amp;family=JetBrains+Mono:wght@400;500&amp;display=swap" rel="stylesheet">
<!-- Tailwind CSS -->
<script src="https://cdn.tailwindcss.com"></script>
<script>
tailwind.config = {
darkMode: 'class',
theme: {
extend: {
fontFamily: {
sans: ['Inter', 'sans-serif'],
mono: ['JetBrains Mono', 'monospace'],
},
colors: {
zinc: {
850: '#1f1f22',
900: '#18181b',
950: '#09090b',
}
},
animation: {
'blur-in': 'blurIn 0.8s cubic-bezier(0.4, 0, 0.2, 1) forwards',
'slide-up': 'slideUp 0.3s ease-out forwards',
},
keyframes: {
blurIn: {
'0%': { filter: 'blur(10px)', opacity: '0', transform: 'translateY(10px)' },
'100%': { filter: 'blur(0)', opacity: '1', transform: 'translateY(0)' },
},
slideUp: {
'0%': { opacity: '0', transform: 'translateY(10px)' },
'100%': { opacity: '1', transform: 'translateY(0)' },
}
}
}
}
}
</script>
<!-- Icons -->
<script src="https://unpkg.com/lucide@latest"></script>
<style>
.custom-scroll::-webkit-scrollbar {
width: 4px;
height: 4px;
}
.custom-scroll::-webkit-scrollbar-track {
background: transparent;
}
.custom-scroll::-webkit-scrollbar-thumb {
background-color: #3f3f46;
border-radius: 20px;
}
.grid-bg {
background-size: 40px 40px;
background-image: linear-gradient(to right, rgba(255, 255, 255, 0.02) 1px, transparent 1px),
linear-gradient(to bottom, rgba(255, 255, 255, 0.02) 1px, transparent 1px);
}
/* Syntax Highlighting Colors Simulation */
.token-keyword { color: #c084fc; } /* purple-400 */
.token-function { color: #60a5fa; } /* blue-400 */
.token-string { color: #fbbf24; } /* amber-400 */
.token-comment { color: #71717a; } /* zinc-500 */
.token-operator { color: #f472b6; } /* pink-400 */
.toc-link.active {
color: white;
border-left-color: white;
}
</style></head>
  <body class="bg-zinc-950 text-zinc-300 font-sans min-h-screen flex flex-col items-center p-4 lg:p-6 selection:bg-emerald-500/30 overflow-x-hidden relative">
    <!-- Background Ambience -->
    <div class="fixed inset-0 overflow-hidden pointer-events-none z-0">
      <div class="absolute -top-[10%] left-[20%] w-[600px] h-[600px] bg-indigo-900/10 rounded-full blur-3xl opacity-20"></div>
      <div class="absolute top-[40%] right-[0%] w-[500px] h-[500px] bg-emerald-900/10 rounded-full blur-3xl opacity-20"></div>
      <div class="absolute inset-0 grid-bg opacity-40"></div>
    </div>

    <!-- Container Wrapper -->
    <div class="w-full max-w-[1100px] flex flex-col gap-8 relative z-10 animate-blur-in">
      <!-- Navbar -->
      <header class="flex items-center justify-between py-4 relative z-50">
        <div class="flex items-center gap-2">
          <div class="w-6 h-6 bg-zinc-100 rounded-sm flex items-center justify-center">
            <div class="w-2 h-2 bg-zinc-900 rounded-full"></div>
          </div>
          <a href="#" class="font-medium tracking-tight text-white text-sm hover:opacity-80 transition-opacity">
            AGENTIA
            <span class="text-zinc-500">/ BLOG</span>
          </a>
        </div>
        <div class="flex items-center gap-3">
          <button class="text-xs font-medium text-zinc-400 hover:text-white transition-colors">
            Volver
          </button>
        </div>
      </header>

      <!-- Main Content Layout -->
      <main class="flex flex-col lg:flex-row gap-12 py-8 min-h-[60vh]">
        
        <!-- Left Column: Article -->
        <article class="flex-1 max-w-3xl">
            
            <!-- Breadcrumb & Date -->
            <div class="flex items-center gap-3 mb-6 text-xs text-zinc-500 font-medium">
                <a href="#" class="hover:text-white transition-colors">Ingeniería</a>
                <span>/</span>
                <span class="text-emerald-400">Deep Dive</span>
                <span class="ml-auto">22 Oct, 2023</span>
            </div>

            <!-- Title Header -->
            <h1 class="text-3xl md:text-5xl font-medium text-white tracking-tight leading-[1.1] mb-6">
                Arquitectura de un Servidor MCP Escalable: De 0 a Producción
            </h1>
            
            <div class="flex items-center justify-between border-b border-white/10 pb-8 mb-8">
                <div class="flex items-center gap-3">
                    <div class="w-8 h-8 rounded-full bg-zinc-800 flex items-center justify-center text-xs text-white font-medium ring-2 ring-zinc-950">DA</div>
                    <div>
                        <div class="text-xs text-white font-medium">David Arroyo</div>
                        <div class="text-[10px] text-zinc-500">Lead Engineer @ Agentia</div>
                    </div>
                </div>
                <div class="flex gap-2">
                    <button class="p-2 rounded-full hover:bg-white/5 text-zinc-400 hover:text-white transition-colors">
                        <i data-lucide="share-2" class="w-4 h-4"></i>
                    </button>
                    <button class="p-2 rounded-full hover:bg-white/5 text-zinc-400 hover:text-white transition-colors">
                        <i data-lucide="bookmark" class="w-4 h-4"></i>
                    </button>
                </div>
            </div>

            <!-- Content Body -->
            <div class="space-y-6 text-zinc-300 leading-7 text-[15px]">
                
                <p class="text-lg text-zinc-200 leading-relaxed font-light">
                    El <span class="text-white font-medium">Model Context Protocol (MCP)</span> está cambiando fundamentalmente cómo los LLMs interactúan con el mundo exterior. Sin embargo, pasar de un script local en Python a un servidor de producción capaz de manejar cientos de conexiones simultáneas presenta desafíos únicos de concurrencia y seguridad.
                </p>

                <h2 id="section-challenges" class="text-xl font-medium text-white tracking-tight mt-10 mb-4 flex items-center gap-2">
                    <i data-lucide="triangle-alert" class="w-5 h-5 text-yellow-500/80"></i>
                    El problema de la latencia
                </h2>
                
                <p>
                    Cuando conectamos Claude Desktop o cualquier cliente compatible a nuestro servidor local, la latencia es insignificante. Pero en un entorno distribuido, cada round-trip cuenta. La arquitectura ingenua de "un proceso por conexión" (thread-per-request) colapsa rápidamente bajo carga.
                </p>

                <div class="bg-zinc-900/50 border border-white/10 rounded-lg p-5 my-6 flex gap-4">
                    <div class="shrink-0 mt-0.5">
                        <i data-lucide="info" class="w-4 h-4 text-indigo-400"></i>
                    </div>
                    <div class="text-sm text-zinc-400">
                        <strong class="text-zinc-200 block mb-1">Nota de Arquitectura</strong>
                        Para sistemas de producción, recomendamos encarecidamente usar <code class="bg-white/10 px-1 py-0.5 rounded text-white font-mono text-xs">asyncio</code> en Python o el runtime de Go para manejar I/O no bloqueante.
                    </div>
                </div>

                <h2 id="section-implementation" class="text-xl font-medium text-white tracking-tight mt-10 mb-4">
                    Implementación Asíncrona
                </h2>

                <p>
                    A continuación, mostramos una estructura base para un servidor MCP que utiliza FastMCP pero con una capa personalizada de gestión de contexto. Observa cómo definimos los recursos estáticos vs. las herramientas dinámicas.
                </p>

                <!-- Code Block -->
                <div class="my-6 rounded-xl overflow-hidden border border-white/10 bg-[#0e0e10] shadow-2xl">
                    <div class="flex items-center justify-between px-4 py-3 bg-white/5 border-b border-white/5">
                        <div class="flex gap-1.5">
                            <div class="w-2.5 h-2.5 rounded-full bg-[#ff5f56]"></div>
                            <div class="w-2.5 h-2.5 rounded-full bg-[#ffbd2e]"></div>
                            <div class="w-2.5 h-2.5 rounded-full bg-[#27c93f]"></div>
                        </div>
                        <span class="text-[10px] font-mono text-zinc-500">server.py</span>
                        <div class="w-4"></div> <!-- Spacer for centering -->
                    </div>
                    <div class="p-4 overflow-x-auto custom-scroll">
<pre class="font-mono text-xs leading-5"><code><span class="token-keyword">from</span> mcp.server.fastmcp <span class="token-keyword">import</span> FastMCP
<span class="token-keyword">import</span> asyncio

<span class="token-comment"># Inicializamos el servidor con dependencias mínimas</span>
mcp = FastMCP(<span class="token-string">"Production Agent"</span>, dependencies=[<span class="token-string">"httpx"</span>])

<span class="token-operator">@</span>mcp.tool()
<span class="token-keyword">async def</span> <span class="token-function">fetch_metrics</span>(service_id: <span class="token-keyword">str</span>) -&gt; <span class="token-keyword">str</span>:
    <span class="token-comment">"""Recupera métricas en tiempo real de forma asíncrona."""</span>
    
    <span class="token-keyword">if not</span> service_id.startswith(<span class="token-string">"svc_"</span>):
        <span class="token-keyword">raise</span> ValueError(<span class="token-string">"ID de servicio inválido"</span>)

    <span class="token-comment"># Simulamos I/O database call</span>
    <span class="token-keyword">await</span> asyncio.sleep(<span class="token-number">0.1</span>)
    
    <span class="token-keyword">return</span> f<span class="token-string">"CPU: 45%, Mem: 2GB para {service_id}"</span>

<span class="token-operator">@</span>mcp.resource(<span class="token-string">"config://app-settings"</span>)
<span class="token-keyword">def</span> <span class="token-function">get_config</span>() -&gt; <span class="token-keyword">str</span>:
    <span class="token-comment">"""Expone configuración segura de solo lectura."""</span>
    <span class="token-keyword">return</span> <span class="token-string">"debug_mode=False\nmax_connections=1000"</span></code></pre>
                    </div>
                </div>

                <p>
                    La clave aquí es el decorador <code class="text-emerald-400 font-mono text-xs">@mcp.tool()</code>. Al definir la función como <code class="font-mono text-xs">async</code>, permitimos que el servidor principal maneje otros requests JSON-RPC mientras espera la respuesta de la base de datos simulada.
                </p>

                <h2 id="section-security" class="text-xl font-medium text-white tracking-tight mt-10 mb-4">
                    Seguridad y Autenticación
                </h2>
                
                <p>
                    No expongas tu servidor MCP directamente a internet sin un proxy inverso. Recomendamos usar Nginx o Cloudflare Tunnels para terminar SSL y manejar la limitación de velocidad (rate limiting) antes de que el tráfico llegue a tu aplicación Python.
                </p>

                <ul class="list-disc list-inside space-y-2 mt-4 marker:text-zinc-600 pl-2">
                    <li>Validar siempre los inputs en las Tools.</li>
                    <li>Usar variables de entorno para las API Keys.</li>
                    <li>Implementar timeouts estrictos en todas las funciones.</li>
                </ul>

                <hr class="border-white/10 my-10">

                <div class="flex flex-col gap-4">
                    <h3 class="text-sm font-medium text-white">Etiquetas</h3>
                    <div class="flex gap-2 flex-wrap">
                        <span class="px-2 py-1 rounded text-[10px] font-medium bg-zinc-900 border border-white/10 text-zinc-400">Python</span>
                        <span class="px-2 py-1 rounded text-[10px] font-medium bg-zinc-900 border border-white/10 text-zinc-400">MCP Protocol</span>
                        <span class="px-2 py-1 rounded text-[10px] font-medium bg-zinc-900 border border-white/10 text-zinc-400">Backend</span>
                    </div>
                </div>

            </div>
        </article>

        <!-- Right Column: Sidebar (TOC) -->
        <aside class="hidden lg:block w-64 shrink-0">
            <div class="sticky top-24">
                <span class="text-[10px] font-bold tracking-wider text-zinc-500 uppercase mb-4 block">
                    En esta página
                </span>
                <nav class="flex flex-col gap-1 border-l border-white/5 relative">
                    <!-- Active Indicator Line (Visual only, would need JS for real movement) -->
                    <div class="absolute left-[-1px] top-0 h-6 w-[1px] bg-white transition-all"></div>

                    <a href="#section-challenges" class="toc-link active pl-4 py-1 text-xs text-white transition-colors hover:text-white block">
                        El problema de la latencia
                    </a>
                    <a href="#section-implementation" class="toc-link pl-4 py-1 text-xs text-zinc-500 transition-colors hover:text-white block">
                        Implementación Asíncrona
                    </a>
                    <a href="#section-security" class="toc-link pl-4 py-1 text-xs text-zinc-500 transition-colors hover:text-white block">
                        Seguridad
                    </a>
                </nav>

                <!-- Promo Box -->
                <div class="mt-8 p-4 rounded-xl bg-gradient-to-br from-zinc-900 to-zinc-950 border border-white/10">
                    <div class="w-8 h-8 rounded bg-emerald-500/10 flex items-center justify-center mb-3">
                        <i data-lucide="zap" class="w-4 h-4 text-emerald-400"></i>
                    </div>
                    <h4 class="text-sm font-medium text-white mb-1">Agentia Cloud</h4>
                    <p class="text-[10px] text-zinc-400 mb-3 leading-relaxed">
                        Despliega tus servidores MCP en segundos sin configurar infraestructura.
                    </p>
                    <button class="w-full py-1.5 rounded bg-white text-zinc-950 text-[10px] font-bold hover:bg-zinc-200 transition-colors">
                        Empezar Gratis
                    </button>
                </div>
            </div>
        </aside>

      </main>

      <!-- Footer -->
      <footer class="border-t border-white/5 pt-8 pb-8 flex flex-col md:flex-row items-center justify-between gap-6">
        <div class="flex flex-col gap-2 text-center md:text-left">
          <div class="flex items-center justify-center md:justify-start gap-2">
            <div class="w-5 h-5 bg-zinc-800 rounded-sm flex items-center justify-center">
              <div class="w-1.5 h-1.5 bg-zinc-400 rounded-full"></div>
            </div>
            <span class="text-xs font-semibold text-zinc-300">
              Agentia Inc.
            </span>
          </div>
        </div>

        <div class="flex items-center gap-6">
          <a href="#" class="text-[10px] text-zinc-500 hover:text-white transition-colors uppercase tracking-wider font-medium">
            Volver al Inicio
          </a>
        </div>
      </footer>
    </div>

    <!-- Floating Chat Component -->
    <div class="fixed bottom-6 right-6 z-50 flex flex-col items-end gap-3 font-sans">
      <div id="widget-window" class="hidden w-[340px] h-[450px] bg-zinc-900/90 backdrop-blur-md border border-white/10 rounded-2xl shadow-2xl flex-col animate-slide-up origin-bottom-right overflow-hidden mb-2 transition-all duration-300">
        <div id="view-login" class="flex flex-col h-full p-6">
          <div class="flex items-center gap-2 mb-6">
            <div class="w-8 h-8 rounded-full bg-gradient-to-tr from-emerald-500 to-teal-500 flex items-center justify-center shadow-lg">
              <i data-lucide="bot" class="w-4 h-4 text-white"></i>
            </div>
            <div>
              <h3 class="text-white font-medium text-sm leading-tight">
                Asistente IA
              </h3>
              <p class="text-zinc-500 text-[10px]">
                Pregunta sobre este artículo
              </p>
            </div>
          </div>
          <div class="space-y-4 flex-1">
            <div class="pt-4">
               <p class="text-[10px] text-zinc-500 mb-2 leading-relaxed">
                   ¿No entiendes el código de ejemplo? Puedo explicártelo línea por línea.
               </p>
            </div>
          </div>
          <button onclick="startInteraction()" class="w-full bg-white text-zinc-950 font-semibold py-3 rounded-xl hover:bg-zinc-200 transition-all text-xs flex items-center justify-center gap-2 shadow-lg shadow-white/5 group">
            <span>Iniciar Chat</span>
            <i data-lucide="message-circle" class="w-3.5 h-3.5 group-hover:translate-x-0.5 transition-transform"></i>
          </button>
        </div>

        <div id="view-chat" class="hidden flex-col h-full">
          <div class="flex items-center justify-between p-4 border-b border-white/5 bg-white/5">
            <div class="flex items-center gap-3">
              <span class="text-sm font-medium text-white">Asistente</span>
            </div>
            <button onclick="toggleWidget()" class="text-zinc-500 hover:text-white transition-colors">
              <i data-lucide="x" class="w-4 h-4"></i>
            </button>
          </div>
          <div class="flex-1 p-4 overflow-y-auto custom-scroll space-y-4">
            <div class="flex gap-3">
              <div class="flex flex-col gap-1 max-w-[85%]">
                <div class="bg-white/5 border border-white/5 p-3 rounded-2xl rounded-tl-sm text-xs text-zinc-300 leading-relaxed">
                  Estoy leyendo el contexto de "Arquitectura MCP". ¿Qué duda tienes sobre la implementación asíncrona?
                </div>
              </div>
            </div>
          </div>
          <div class="p-3 border-t border-white/5 bg-zinc-900/50">
            <div class="relative flex items-center">
              <input type="text" placeholder="Escribe tu pregunta..." class="w-full bg-zinc-950 border border-white/10 rounded-full pl-4 pr-10 py-2.5 text-xs text-white placeholder-zinc-600 focus:outline-none focus:border-emerald-500/50 transition-colors">
              <button class="absolute right-1.5 p-1.5 bg-emerald-500 rounded-full text-zinc-950 hover:bg-emerald-400 transition-colors">
                <i data-lucide="arrow-up" class="w-3 h-3"></i>
              </button>
            </div>
          </div>
        </div>
      </div>

      <button onclick="toggleWidget()" class="h-14 w-14 rounded-full bg-white text-zinc-950 shadow-[0_0_30px_rgba(255,255,255,0.2)] hover:scale-105 transition-transform flex items-center justify-center relative group z-50">
        <i data-lucide="sparkles" class="w-6 h-6 fill-zinc-950 group-hover:scale-110 transition-transform duration-300"></i>
      </button>

      <script>
        const widgetWindow = document.getElementById('widget-window');
        const loginView = document.getElementById('view-login');
        const chatView = document.getElementById('view-chat');

        function toggleWidget() {
            if (widgetWindow.classList.contains('hidden')) {
                widgetWindow.classList.remove('hidden');
                widgetWindow.classList.add('flex');
            } else {
                widgetWindow.classList.add('hidden');
                widgetWindow.classList.remove('flex');
            }
        }

        function startInteraction() {
          loginView.classList.add('hidden');
          chatView.classList.remove('hidden');
          chatView.classList.add('flex');
        }
      </script>
    </div>

    <script>
      lucide.createIcons();
    </script>
  
</body></html>